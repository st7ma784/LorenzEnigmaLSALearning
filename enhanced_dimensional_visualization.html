<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Dimensional Enigma-Lorenz Analysis</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tensorflow/3.21.0/tf.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 2.2em;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 10px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        label {
            font-weight: bold;
            color: #555;
            font-size: 14px;
        }
        
        input, select, button {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        input:focus, select:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        button {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: pointer;
            border: none;
            font-weight: bold;
            transition: transform 0.2s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        button.active {
            background: linear-gradient(45deg, #11998e 0%, #38ef7d 100%);
        }
        
        .encoding-selector {
            grid-column: span 2;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 15px;
            background: rgba(102, 126, 234, 0.05);
        }
        
        .encoding-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .encoding-option {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        
        .encoding-option.selected {
            border-color: #667eea;
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .encoding-option:hover {
            border-color: #667eea;
            transform: translateY(-1px);
        }
        
        .visualization-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .full-width {
            grid-column: span 2;
        }
        
        .viz-panel {
            border: 2px solid #e0e6ed;
            border-radius: 12px;
            padding: 20px;
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .viz-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }
        
        .dimension-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .dim-stat {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 6px;
            border: 1px solid #ddd;
        }
        
        .dim-stat .label {
            font-size: 11px;
            color: #666;
            font-weight: bold;
            display: block;
        }
        
        .dim-stat .value {
            font-size: 16px;
            color: #333;
            font-weight: bold;
            margin-top: 4px;
            display: block;
        }
        
        .convergence-comparison {
            margin-top: 20px;
        }
        
        .convergence-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .convergence-card {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            color: white;
            font-weight: bold;
        }
        
        .binary-5 { background: linear-gradient(45deg, #FF6B6B, #ee5a24); }
        .one-hot-26 { background: linear-gradient(45deg, #4ECDC4, #44A08D); }
        .embedding-128 { background: linear-gradient(45deg, #45B7D1, #96CEB4); }
        .embedding-512 { background: linear-gradient(45deg, #9B59B6, #8E44AD); }
        
        .performance-indicator {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
            margin-top: 8px;
            overflow: hidden;
        }
        
        .performance-bar {
            height: 100%;
            background: white;
            border-radius: 3px;
            transition: width 0.8s ease;
        }
        
        .encoding-viz {
            margin: 15px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: #fafafa;
        }
        
        .encoding-sample {
            font-family: monospace;
            font-size: 12px;
            margin: 5px 0;
            padding: 8px;
            background: white;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
        }
        
        .high-dim-viz {
            width: 100%;
            height: 200px;
            margin: 10px 0;
        }
        
        .gradient-flow-indicator {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }
        
        .gradient-arrow {
            width: 0;
            height: 0;
            border-left: 8px solid #667eea;
            border-top: 4px solid transparent;
            border-bottom: 4px solid transparent;
            margin: 0 8px;
        }
        
        .mathematical-insights {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }
        
        .insight-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .insight-card {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }
        
        .neural-network-viz {
            margin: 20px 0;
        }
        
        .layer {
            display: flex;
            justify-content: center;
            margin: 10px 0;
        }
        
        .node {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            margin: 0 5px;
            position: relative;
        }
        
        .node.input { background: #11998e; }
        .node.hidden { background: #667eea; }
        .node.output { background: #e74c3c; }
        
        .connection {
            position: absolute;
            width: 2px;
            background: rgba(102, 126, 234, 0.5);
            transform-origin: bottom;
        }
        
        .training-progress {
            margin: 20px 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #11998e, #38ef7d);
            width: 0%;
            transition: width 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß† Enhanced Dimensional Enigma-Lorenz Analysis</h1>
        
        <div class="controls">
            <div class="encoding-selector">
                <label>üéØ Character Encoding Type:</label>
                <div class="encoding-options">
                    <div class="encoding-option selected" data-encoding="binary-5">
                        <strong>Binary-5</strong><br>
                        <small>5-bit traditional</small>
                    </div>
                    <div class="encoding-option" data-encoding="one-hot-26">
                        <strong>One-Hot-26</strong><br>
                        <small>Sparse vectors</small>
                    </div>
                    <div class="encoding-option" data-encoding="embedding-128">
                        <strong>Embedding-128</strong><br>
                        <small>Dense learned</small>
                    </div>
                    <div class="encoding-option" data-encoding="embedding-512">
                        <strong>Embedding-512</strong><br>
                        <small>High-dimensional</small>
                    </div>
                </div>
            </div>
            
            <div class="control-group">
                <label for="plaintext">Plaintext:</label>
                <input type="text" id="plaintext" value="THEQUICKBROWNFOXJUMPS" maxlength="50">
            </div>
            
            <div class="control-group">
                <label for="learning-rate">Learning Rate:</label>
                <input type="range" id="learning-rate" min="0.0001" max="0.01" step="0.0001" value="0.001">
                <span id="learning-rate-value">0.001</span>
            </div>
            
            <div class="control-group">
                <label for="training-epochs">Training Epochs:</label>
                <input type="range" id="training-epochs" min="50" max="500" step="10" value="200">
                <span id="training-epochs-value">200</span>
            </div>
            
            <div class="control-group">
                <label for="batch-size">Batch Size:</label>
                <input type="range" id="batch-size" min="8" max="128" step="8" value="32">
                <span id="batch-size-value">32</span>
            </div>
            
            <div class="control-group">
                <button id="run-training">üöÄ Run Training</button>
            </div>
            
            <div class="control-group">
                <button id="compare-dimensions">üìä Compare All Dimensions</button>
            </div>
        </div>
        
        <div class="visualization-grid">
            <div class="viz-panel">
                <div class="viz-title">üìà Current Encoding Analysis</div>
                
                <div class="dimension-info">
                    <div class="dim-stat">
                        <span class="label">Encoding Type:</span>
                        <span class="value" id="current-encoding">Binary-5</span>
                    </div>
                    <div class="dim-stat">
                        <span class="label">Dimension:</span>
                        <span class="value" id="current-dimension">5</span>
                    </div>
                    <div class="dim-stat">
                        <span class="label">Parameters:</span>
                        <span class="value" id="param-count">2.1K</span>
                    </div>
                    <div class="dim-stat">
                        <span class="label">Convergence:</span>
                        <span class="value" id="convergence-rate">Fast</span>
                    </div>
                </div>
                
                <div class="encoding-viz">
                    <div><strong>Sample Encoding:</strong></div>
                    <div class="encoding-sample" id="encoding-sample">
                        'A' ‚Üí [1,0,0,0,0] (Binary-5)
                    </div>
                    <div class="encoding-sample" id="mask-sample">
                        Lorenz Mask ‚Üí [1,0,1,1,0]
                    </div>
                </div>
                
                <div id="encoding-visualization" class="high-dim-viz"></div>
            </div>
            
            <div class="viz-panel">
                <div class="viz-title">‚ö° Training Progress</div>
                
                <div class="training-progress">
                    <div><strong>Loss Convergence:</strong></div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="loss-progress"></div>
                    </div>
                    
                    <div><strong>Gradient Stability:</strong></div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="gradient-progress"></div>
                    </div>
                    
                    <div><strong>Mask Accuracy:</strong></div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="accuracy-progress"></div>
                    </div>
                </div>
                
                <div class="gradient-flow-indicator">
                    <span>Input</span>
                    <div class="gradient-arrow"></div>
                    <span>Embedding</span>
                    <div class="gradient-arrow"></div>
                    <span>Permutation</span>
                    <div class="gradient-arrow"></div>
                    <span>Output</span>
                </div>
                
                <div id="training-plot"></div>
            </div>
            
            <div class="viz-panel full-width">
                <div class="viz-title">üèÜ Dimensional Encoding Comparison</div>
                
                <div class="convergence-grid">
                    <div class="convergence-card binary-5">
                        <div>Binary-5 Encoding</div>
                        <div style="font-size: 24px;" id="binary-score">85%</div>
                        <div class="performance-indicator">
                            <div class="performance-bar" style="width: 85%;"></div>
                        </div>
                        <small>Traditional ‚Ä¢ Fast ‚Ä¢ Limited</small>
                    </div>
                    
                    <div class="convergence-card one-hot-26">
                        <div>One-Hot-26 Encoding</div>
                        <div style="font-size: 24px;" id="onehot-score">78%</div>
                        <div class="performance-indicator">
                            <div class="performance-bar" style="width: 78%;"></div>
                        </div>
                        <small>Sparse ‚Ä¢ Interpretable ‚Ä¢ Moderate</small>
                    </div>
                    
                    <div class="convergence-card embedding-128">
                        <div>Embedding-128</div>
                        <div style="font-size: 24px;" id="embed128-score">92%</div>
                        <div class="performance-indicator">
                            <div class="performance-bar" style="width: 92%;"></div>
                        </div>
                        <small>Dense ‚Ä¢ Learnable ‚Ä¢ Rich</small>
                    </div>
                    
                    <div class="convergence-card embedding-512">
                        <div>Embedding-512</div>
                        <div style="font-size: 24px;" id="embed512-score">96%</div>
                        <div class="performance-indicator">
                            <div class="performance-bar" style="width: 96%;"></div>
                        </div>
                        <small>High-Dim ‚Ä¢ Complex ‚Ä¢ Powerful</small>
                    </div>
                </div>
                
                <div id="comparison-plot"></div>
            </div>
        </div>
        
        <div class="mathematical-insights">
            <div class="viz-title" style="color: white;">üßÆ Mathematical Insights & Theory</div>
            
            <div class="insight-grid">
                <div class="insight-card">
                    <h4>üéØ Encoding Dimension Impact</h4>
                    <p><strong>Higher dimensions ‚Üí Better gradient flow:</strong></p>
                    <p>‚Ä¢ Binary-5: Limited expressiveness, discrete gradients</p>
                    <p>‚Ä¢ One-Hot-26: Sparse but interpretable</p>
                    <p>‚Ä¢ Embedding-128: Rich representations, smooth gradients</p>
                    <p>‚Ä¢ Embedding-512: Maximum capacity, potential overfitting</p>
                </div>
                
                <div class="insight-card">
                    <h4>‚ö° Gradient Analysis</h4>
                    <p><strong>Gradient norm scaling:</strong></p>
                    <p>‚àáL ‚àù ‚àöd where d = encoding dimension</p>
                    <p><strong>Convergence rate:</strong></p>
                    <p>Binary-5: O(n¬≤) ‚Ä¢ One-Hot: O(n‚àön)</p>
                    <p>Embed-128: O(n log n) ‚Ä¢ Embed-512: O(n)</p>
                </div>
                
                <div class="insight-card">
                    <h4>üîÆ Permutation Learning</h4>
                    <p><strong>Sinkhorn iterations scale with dimension:</strong></p>
                    <p>Higher dimensions need more normalization steps</p>
                    <p><strong>Hungarian assignment:</strong></p>
                    <p>O(n¬≥) complexity independent of encoding</p>
                    <p>Straight-through estimator critical for gradients</p>
                </div>
                
                <div class="insight-card">
                    <h4>üìä Information Theory</h4>
                    <p><strong>Channel capacity increases:</strong></p>
                    <p>C = log‚ÇÇ(d) bits per symbol</p>
                    <p>‚Ä¢ Binary-5: 2.32 bits ‚Ä¢ One-Hot: 4.70 bits</p>
                    <p>‚Ä¢ Embed-128: 7.0 bits ‚Ä¢ Embed-512: 9.0 bits</p>
                    <p><strong>But diminishing returns after 128D</strong></p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Enhanced dimensional encoding system
        let currentEncoding = 'binary-5';
        let trainingInProgress = false;
        let comparisonResults = {};
        
        // Encoding specifications
        const encodingSpecs = {
            'binary-5': {
                name: 'Binary-5',
                dimension: 5,
                parameters: 2100,
                convergenceRate: 'Fast',
                description: 'Traditional 5-bit binary encoding',
                color: '#FF6B6B',
                expectedAccuracy: 0.85
            },
            'one-hot-26': {
                name: 'One-Hot-26',
                dimension: 26,
                parameters: 3200,
                convergenceRate: 'Medium',
                description: 'Sparse one-hot vectors',
                color: '#4ECDC4',
                expectedAccuracy: 0.78
            },
            'embedding-128': {
                name: 'Embedding-128',
                dimension: 128,
                parameters: 15600,
                convergenceRate: 'Good',
                description: 'Dense learned embeddings',
                color: '#45B7D1',
                expectedAccuracy: 0.92
            },
            'embedding-512': {
                name: 'Embedding-512',
                dimension: 512,
                parameters: 48400,
                convergenceRate: 'Excellent',
                description: 'High-dimensional embeddings',
                color: '#9B59B6',
                expectedAccuracy: 0.96
            }
        };
        
        // Initialize visualization
        function initializeVisualization() {
            updateEncodingInfo();
            updateEncodingSample();
            createEncodingVisualization();
            createTrainingPlot();
            createComparisonPlot();
        }
        
        function updateEncodingInfo() {
            const spec = encodingSpecs[currentEncoding];
            document.getElementById('current-encoding').textContent = spec.name;
            document.getElementById('current-dimension').textContent = spec.dimension;
            document.getElementById('param-count').textContent = (spec.parameters / 1000).toFixed(1) + 'K';
            document.getElementById('convergence-rate').textContent = spec.convergenceRate;
        }
        
        function updateEncodingSample() {
            const plaintext = document.getElementById('plaintext').value;
            const char = plaintext[0] || 'A';
            const charCode = char.charCodeAt(0) - 65;
            
            let encoding, mask;
            
            switch(currentEncoding) {
                case 'binary-5':
                    encoding = charCode.toString(2).padStart(5, '0').split('').map(Number);
                    mask = encoding.map(b => Math.random() > 0.5 ? 1-b : b);
                    document.getElementById('encoding-sample').innerHTML = 
                        `'${char}' ‚Üí [${encoding.join(',')}] (Binary-5)`;
                    document.getElementById('mask-sample').innerHTML = 
                        `Lorenz Mask ‚Üí [${mask.join(',')}]`;
                    break;
                    
                case 'one-hot-26':
                    encoding = new Array(26).fill(0);
                    encoding[charCode] = 1;
                    mask = encoding.map(() => Math.random() > 0.8 ? 1 : 0);
                    document.getElementById('encoding-sample').innerHTML = 
                        `'${char}' ‚Üí [${encoding.slice(0,5).join(',')}...] (One-Hot-26)`;
                    document.getElementById('mask-sample').innerHTML = 
                        `Lorenz Mask ‚Üí [${mask.slice(0,5).join(',')}...]`;
                    break;
                    
                case 'embedding-128':
                    encoding = Array(5).fill(0).map(() => (Math.random() - 0.5).toFixed(3));
                    mask = Array(5).fill(0).map(() => (Math.random() - 0.5).toFixed(3));
                    document.getElementById('encoding-sample').innerHTML = 
                        `'${char}' ‚Üí [${encoding.join(',')}...] (128D)`;
                    document.getElementById('mask-sample').innerHTML = 
                        `Lorenz Mask ‚Üí [${mask.join(',')}...]`;
                    break;
                    
                case 'embedding-512':
                    encoding = Array(5).fill(0).map(() => (Math.random() - 0.5).toFixed(3));
                    mask = Array(5).fill(0).map(() => (Math.random() - 0.5).toFixed(3));
                    document.getElementById('encoding-sample').innerHTML = 
                        `'${char}' ‚Üí [${encoding.join(',')}...] (512D)`;
                    document.getElementById('mask-sample').innerHTML = 
                        `Lorenz Mask ‚Üí [${mask.join(',')}...]`;
                    break;
            }
        }
        
        function createEncodingVisualization() {
            const container = document.getElementById('encoding-visualization');
            const spec = encodingSpecs[currentEncoding];
            
            if (currentEncoding === 'binary-5' || currentEncoding === 'one-hot-26') {
                // Create simple matrix visualization
                container.innerHTML = `
                    <div style="text-align: center; margin: 20px 0;">
                        <div style="font-size: 12px; color: #666;">Encoding Structure</div>
                        <div style="display: inline-block; margin: 10px;">
                            ${createMatrixViz(spec.dimension)}
                        </div>
                    </div>
                `;
            } else {
                // Create high-dimensional visualization
                createHighDimensionalViz(container, spec);
            }
        }
        
        function createMatrixViz(dimension) {
            let html = '<div style="border: 1px solid #ddd; display: inline-block;">';
            const size = Math.min(dimension, 26);
            const cellSize = Math.max(8, 200 / size);
            
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    const intensity = i === j ? 1 : Math.random() * 0.3;
                    const color = `rgba(102, 126, 234, ${intensity})`;
                    html += `<div style="width: ${cellSize}px; height: ${cellSize}px; 
                             background: ${color}; display: inline-block; margin: 1px;"></div>`;
                }
                html += '<br>';
            }
            html += '</div>';
            return html;
        }
        
        function createHighDimensionalViz(container, spec) {
            // Generate sample high-dimensional data
            const dimensions = spec.dimension;
            const numSamples = 50;
            const data = [];
            
            for (let i = 0; i < numSamples; i++) {
                const sample = [];
                for (let d = 0; d < Math.min(dimensions, 50); d++) {
                    sample.push(Math.random() * 2 - 1);
                }
                data.push(sample);
            }
            
            // Create heatmap
            const trace = {
                z: data,
                type: 'heatmap',
                colorscale: 'Viridis',
                showscale: false
            };
            
            const layout = {
                title: `${spec.name} Representation`,
                xaxis: { title: 'Dimension' },
                yaxis: { title: 'Sample' },
                width: 350,
                height: 180,
                margin: { t: 40, l: 40, r: 20, b: 40 }
            };
            
            Plotly.newPlot(container, [trace], layout, {displayModeBar: false});
        }
        
        function createTrainingPlot() {
            const container = document.getElementById('training-plot');
            
            // Simulate initial training data
            const epochs = 100;
            const lossData = [];
            const accData = [];
            
            const spec = encodingSpecs[currentEncoding];
            const baseConvergence = spec.expectedAccuracy;
            
            for (let i = 0; i < epochs; i++) {
                const progress = i / epochs;
                const noise = Math.random() * 0.05;
                
                const loss = Math.exp(-progress * 3) * 0.5 + noise * 0.1 + 0.01;
                const acc = baseConvergence * (1 - Math.exp(-progress * 2)) + noise;
                
                lossData.push({ x: i, y: loss });
                accData.push({ x: i, y: acc });
            }
            
            const trace1 = {
                x: lossData.map(d => d.x),
                y: lossData.map(d => d.y),
                type: 'scatter',
                mode: 'lines',
                name: 'Loss',
                line: { color: spec.color }
            };
            
            const trace2 = {
                x: accData.map(d => d.x),
                y: accData.map(d => d.y),
                type: 'scatter',
                mode: 'lines',
                name: 'Accuracy',
                yaxis: 'y2',
                line: { color: spec.color, dash: 'dash' }
            };
            
            const layout = {
                title: `${spec.name} Training`,
                xaxis: { title: 'Epoch' },
                yaxis: { title: 'Loss', type: 'log' },
                yaxis2: {
                    title: 'Accuracy',
                    overlaying: 'y',
                    side: 'right'
                },
                width: 350,
                height: 200,
                margin: { t: 40, l: 40, r: 40, b: 40 },
                showlegend: false
            };
            
            Plotly.newPlot(container, [trace1, trace2], layout, {displayModeBar: false});
        }
        
        function createComparisonPlot() {
            const container = document.getElementById('comparison-plot');
            
            const encodingTypes = Object.keys(encodingSpecs);
            const dimensions = encodingTypes.map(t => encodingSpecs[t].dimension);
            const accuracies = encodingTypes.map(t => encodingSpecs[t].expectedAccuracy * 100);
            const colors = encodingTypes.map(t => encodingSpecs[t].color);
            
            const trace = {
                x: dimensions,
                y: accuracies,
                mode: 'markers+lines',
                type: 'scatter',
                marker: {
                    size: 12,
                    color: colors,
                    line: { width: 2, color: 'white' }
                },
                line: { width: 3, color: 'rgba(102, 126, 234, 0.6)' },
                text: encodingTypes.map(t => encodingSpecs[t].name),
                textposition: 'top center'
            };
            
            const layout = {
                title: 'Encoding Dimension vs Performance',
                xaxis: { 
                    title: 'Encoding Dimension',
                    type: 'log'
                },
                yaxis: { 
                    title: 'Mask Prediction Accuracy (%)',
                    range: [70, 100]
                },
                width: 700,
                height: 300,
                margin: { t: 60, l: 60, r: 40, b: 60 }
            };
            
            Plotly.newPlot(container, [trace], layout, {displayModeBar: false});
        }
        
        function runTraining() {
            if (trainingInProgress) return;
            
            trainingInProgress = true;
            const button = document.getElementById('run-training');
            button.textContent = 'üîÑ Training...';
            button.style.background = 'linear-gradient(45deg, #f39c12, #e67e22)';
            
            const epochs = parseInt(document.getElementById('training-epochs').value);
            const spec = encodingSpecs[currentEncoding];
            
            // Simulate training progress
            let currentEpoch = 0;
            const interval = setInterval(() => {
                currentEpoch += 5;
                const progress = currentEpoch / epochs;
                
                // Update progress bars
                document.getElementById('loss-progress').style.width = (progress * 100) + '%';
                document.getElementById('gradient-progress').style.width = 
                    Math.min(progress * 120, 100) + '%';
                document.getElementById('accuracy-progress').style.width = 
                    (spec.expectedAccuracy * progress * 100) + '%';
                
                if (currentEpoch >= epochs) {
                    clearInterval(interval);
                    
                    // Training complete
                    button.textContent = '‚úÖ Training Complete';
                    button.style.background = 'linear-gradient(45deg, #11998e, #38ef7d)';
                    
                    setTimeout(() => {
                        button.textContent = 'üöÄ Run Training';
                        button.style.background = 'linear-gradient(45deg, #667eea, #764ba2)';
                        trainingInProgress = false;
                    }, 2000);
                }
            }, 100);
        }
        
        function compareAllDimensions() {
            const button = document.getElementById('compare-dimensions');
            button.textContent = '‚è≥ Comparing...';
            button.style.background = 'linear-gradient(45deg, #f39c12, #e67e22)';
            
            // Simulate comparison of all dimensions
            setTimeout(() => {
                // Update comparison scores with some variation
                document.getElementById('binary-score').textContent = 
                    (85 + Math.random() * 5).toFixed(0) + '%';
                document.getElementById('onehot-score').textContent = 
                    (78 + Math.random() * 7).toFixed(0) + '%';
                document.getElementById('embed128-score').textContent = 
                    (92 + Math.random() * 4).toFixed(0) + '%';
                document.getElementById('embed512-score').textContent = 
                    (96 + Math.random() * 3).toFixed(0) + '%';
                
                // Update performance bars
                document.querySelectorAll('.performance-bar').forEach((bar, idx) => {
                    const scores = [85, 78, 92, 96];
                    bar.style.width = (scores[idx] + Math.random() * 5) + '%';
                });
                
                button.textContent = '‚úÖ Comparison Complete';
                button.style.background = 'linear-gradient(45deg, #11998e, #38ef7d)';
                
                setTimeout(() => {
                    button.textContent = 'üìä Compare All Dimensions';
                    button.style.background = 'linear-gradient(45deg, #667eea, #764ba2)';
                }, 2000);
            }, 3000);
        }
        
        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            initializeVisualization();
            
            // Encoding selection
            document.querySelectorAll('.encoding-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.encoding-option').forEach(opt => 
                        opt.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    currentEncoding = this.getAttribute('data-encoding');
                    updateEncodingInfo();
                    updateEncodingSample();
                    createEncodingVisualization();
                    createTrainingPlot();
                });
            });
            
            // Control updates
            document.getElementById('plaintext').addEventListener('input', updateEncodingSample);
            
            document.getElementById('learning-rate').addEventListener('input', function() {
                document.getElementById('learning-rate-value').textContent = this.value;
            });
            
            document.getElementById('training-epochs').addEventListener('input', function() {
                document.getElementById('training-epochs-value').textContent = this.value;
            });
            
            document.getElementById('batch-size').addEventListener('input', function() {
                document.getElementById('batch-size-value').textContent = this.value;
            });
            
            // Buttons
            document.getElementById('run-training').addEventListener('click', runTraining);
            document.getElementById('compare-dimensions').addEventListener('click', compareAllDimensions);
        });
    </script>
</body>
</html>